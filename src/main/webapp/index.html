<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Title</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <style>
        body,div,ul,li,a{
            margin:0;
            padding:0;
        }
        li{
            list-style-type:none;
        }
    </style>
    <style type="text/css">
        #data_content{
            margin-left:352px;
        }
        #data_page{
            max-width: 960px;
            position:relative;
            margin:0 auto;
            padding:15px;
        }

        #left{
            min-height: 256px;
            float: left;
            overflow:auto;
            margin-top:10px;
            top:0;
            bottom: 0;
            left:0;
            background: #F2F2F2;
        }
        #list{
            background:#F2F2F2;
        }
        #list li{
            width:352px;
            box-sizing: border-box;
            background:#F2F2F2;
            transition: background 0.2s ease;
            -moz-transition: background 0.2s ease; /* Firefox 4 */
            -webkit-transition: background 0.2s ease; /* Safari 和 Chrome */
            -o-transition: background 0.2s ease;
        }
        #list li:hover{
            border-right:2px solid #EC0033;
            background:#FFD1D2;
        }
        #list a{
            padding:5px 8px;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-decoration-line: none;
        }
        #list a:hover{
            overflow: visible;
            white-space: pre-wrap;
            color:#EC0033;
            cursor:pointer;
        }
        .list_active {
            color:#E3161C;
        }
        #page_wrap{

        }
        .pages{
            display: inline-block;
        }
        .active{

        }
        .map{
            margin:10px 20px;
            height:500px;
        }
        #overlay_hide{
            display: none;
        }
        #overlay_show{
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index:1001;
            -moz-opacity: 0.3;
            opacity:.30;
            filter: alpha(opacity=30);
        }
        .showAboveOverlay{
            position: relative;
            z-index:10000;
        }
    </style>
    <style type="text/css">
        .info{
            padding: 6px 8px;
            background:rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
    </style>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.0/jquery.min.js">
    </script>
    
    
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
    
</head>
<body>
    <div id="overlay_hide"></div><!-- 遮罩 -->
    <div>
        <button id="play" onclick="playGallery()">play!</button>
        <button id="pause" onclick="pauseGallery()">pause!</button>
        <button id="chooose" onclick="chooseFile()">chooose!</button>
    </div>
    <div id="content">
        <div></div>
        <div id="left">
            <div id="list">
                <ul>
                    
                </ul>
                <!-- <dl>
                    <dt>Name</dt>
                    <dd><ul>
                        <li>1</li>
                        <li>2</li>
                    </ul></dd>
                    
                </dl> -->
            </div>
                <div id="page_wrap">
                    <ul class="pages">
                    </ul>
                </div>
        </div>
        <!-- <CANVAS id="square" width="200" height="200">Your browser does not support the HTML5 canvas tag.</CANVAS> -->
        <div id="data_content">
            <div id="data_page">
                <div id="map" class="map"></div>
            </div>
        </div>

    </div>

    <script type="text/javascript">
        //code for map (leaflet)
        var mymap = L.map('map').setView([40.72,-74.2],6);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw'
        }).addTo(mymap);
        
//        var singleOverlay=L.imageOverlay();
        var group=L.layerGroup();
        var rec
        function showImg(imageUrl,hf){
            var imageBounds=hf.bounds;
            //singleOverlay.setUrl(imageUrl).setBounds(imageBounds).addTo(mymap);
            var over=L.imageOverlay(imageUrl,imageBounds,{interactive:true});

            //hover特效
            rec=L.rectangle(imageBounds,{color: "#ff7800", weight: 1,opacity:0,fillOpacity:0})//.addTo(mymap);
            rec.on({
                mouseover:highlight,
                mouseout:reset_highlight
            })

            group.clearLayers().addLayer(over).addLayer(rec).addTo(mymap);
            mymap.fitBounds(imageBounds);

            info.update(hf);
        }
        function highlight(e){
            e.target.setStyle({opacity:1});
        }
        function reset_highlight(e){
            e.target.setStyle({opacity:0});
        }
    </script>
    <script type="text/javascript">
        var fileList=[];
        var testfiles=["KFWD_SDUS64_NCZGRK_201208150217",
                    "SATE_L2_F2G_VISSR_MWB_LBT_SEC_LCN-IR2-20170527-0100.AWX",
                    "KEWX_SDUS54_N0VEWX_201707270600"]
        getFileList();

        function init(files){
            var $ul = $('#list>ul');
            for(var i=0;i<files.length;i++){
                $ul.append("<li><a class='file'>"+files[i]+"</a></li>")
            }
            $('.file').each(function(){
                setClickDe($(this));
            });
            var $pages=$('#page_wrap.pages');
            for(var i=0;i<files.length/10;i++){
                $pages.append("<li><a>"+i+"</a></li>")
            }
            initInfo();
        }
        var info = L.control();
        function initInfo(){
            info.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
                this.update();
                return this._div;
            };
            info.update = function (props) {
                this._div.innerHTML = '<h4>File Info</h4>' +  (props ?
                    '<b>' + props.time + '</b><br />'
                    : '');
            };

            info.addTo(mymap);
        }
        function setClickDe(dom){
            dom.click(function(){
                getData($(this).html());
                $('.file').each(function(){$(this).removeClass("list_active")});
                $(this).addClass("list_active");
            })
        }
        
        function getFileList(){
            $.ajax({
                    url:'/radar/rest/r/files/list',
                    type:"GET",
                    // async:false,
                    success:function(result){
                        var json=JSON.parse(result);
                        fileList=json;
                        init(json);
                    }
                });
        }
        function getData(file){
            var json;
                $.ajax({
                    url:'/radar/rest/r/files/'+file,
                    type:"GET",
                    // async:false,
                    success:function(result){
                        json=JSON.parse(result)
                        var hf=json.headfile;
                        var bounds=hf.bounds;
                        var img=json.imgUrl;
                        showImg(img,hf);
                        // var c;
                        // switch(type){
                            // case 1:
                                // c=createGridImage_Satellite(array,array[0].length,array.length);
                                // break;
                            // case 2:
                                // c=createGridImage_Radar(array,array[0].length,array.length);
                                // break;
                            // case 3:
                                // c=createRadialImage(array,data.azimuth,data.gNum);
                                // break;
                        // }
                        // console.log("getData:"+c.width);
                        // setStyle(c);

                    }
                });
        }

        //gallery
        var key;
        var index=0;
        var listData;
        var chooseList;
        Array.prototype.indexOf = function(val) {
            for (var i = 0; i < this.length; i++) {
                if (this[i] == val) return i;
            }
            return -1;
        };
        function playGallery(){
            resetOverlay()
            listData=new Array();
            for(var i=0;i<chooseList.length;i++){
                $.ajax({
                    url: '/radar/rest/r/files/' + chooseList[i],
                    type: "GET",
                    async:false,
                    success: function (result) {
                        json = JSON.parse(result)
                        var hf = json.headfile;
                        var bounds = hf.bounds;
                        var img = json.imgUrl;
                        listData[i]=new Object();
                        listData[i].hf=hf;
                        listData[i].img=img;
                    }
                })
            }
            for(var i=0;i<chooseList.length;i++){
                console.log(listData[i]);
            }
            key=setInterval(function () {
                if(index<chooseList.length){
                    showImg(listData[index].img,listData[index].hf);
                    index++;
                }else{
                    pauseGallery()
                }
            },1000)
        }
        function pauseGallery(){
            key=clearInterval(key);
            $('.file').each(function(){
                $(this).unbind('click').removeClass("list_active");
                setClickDe($(this))

            });
        }
        function chooseFile(dom){
            setOverlay()
            chooseList=new Array();
            $('.file').each(function(){
                setClickChoose($(this))
            })
        }
        function setClickChoose(dom){
            dom.unbind('click').bind('click',function(){
                console.log($(this).html());
                chooseList.push($(this).html());
                $(this).addClass("list_active");
                for(var i=0;i<chooseList.length;i++){
                    console.log(chooseList[i]);
                }
                setClickCancel(dom)
            })
        }
        function setClickCancel(dom){
            dom.unbind('click').click(function(){
                var i=chooseList.valueOf($(this).html());
                if(i!==-1){
                    chooseList.splice(i,1);
                }
                $(this).removeClass("list_active");
                setClickChoose(dom);
            })
        }
        function setOverlay(){
            $('#play').addClass('showAboveOverlay');
            $('#list').addClass('showAboveOverlay');
            $('#overlay_hide').attr('id','overlay_show');
        }
        function resetOverlay(){
            $('#overlay_show').attr('id','overlay_hide');
            $('#list').removeClass('showAboveOverlay');
            $('#play').removeClass('showAboveOverlay');
        }
    </script>
    
</body>
</html>